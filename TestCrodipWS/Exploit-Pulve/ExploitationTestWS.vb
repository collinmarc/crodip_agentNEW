Imports System.Text
Imports Microsoft.VisualStudio.TestTools.UnitTesting
Imports CRODIPWS
Imports System.Xml.Serialization
Imports System.IO
Imports System.Net.Http

<TestClass()> Public Class ExploitationTestWS
    Inherits CRODIPTest

    <TestMethod()> Public Sub getWS()
        Dim Exploitation As CRODIPWS.Exploitation
        Exploitation = ExploitationManager.WSgetById(96934, "")
        Assert.AreEqual(96934, Exploitation.uid)
        Assert.IsNotNull(Exploitation)

    End Sub
    <TestMethod()> Public Sub sendWS()
        Dim oExploitation As CRODIPWS.Exploitation
        oExploitation = ExploitationManager.WSgetById(96934, "")
        Assert.IsNotNull(oExploitation)
        oExploitation.nomExploitant = "TESTUMCO"
        Dim oreturn As CRODIPWS.Exploitation
        Dim nReturn As Integer
        nReturn = ExploitationManager.WSSend(oExploitation, oreturn)
        Assert.AreEqual(2, nReturn)
        oExploitation = ExploitationManager.WSgetById(96934, "")
        Assert.AreEqual("TESTUMCO", oExploitation.nomExploitant)

    End Sub
    <TestMethod()> Public Sub CRUDWS()
        Dim nreturn As Integer
        Dim oExploitation As New Exploitation()
        oExploitation.id = "1-1-1"
        oExploitation.nomExploitant = "TU_MCO"

        ' Création de l'objet
        Dim oReturn As Exploitation
        nreturn = ExploitationManager.WSSend(oExploitation, oReturn)
        Assert.IsNotNull(oReturn.uid)

        'Lecture de l'objet
        oExploitation = ExploitationManager.WSgetById(oReturn.uid, oReturn.aid)
        Assert.AreEqual("TU_MCO", oExploitation.nomExploitant)
        Assert.AreEqual("1-1-1", oExploitation.id)

        'Update de l'objet
        oExploitation.nomExploitant = "TU_UPDATE"
        nreturn = ExploitationManager.WSSend(oExploitation, oReturn)
        Assert.AreEqual(oExploitation.uid, oReturn.uid)
        Assert.AreEqual(2, nreturn)
        Assert.AreEqual("TU_UPDATE", oExploitation.nomExploitant)
        Assert.AreEqual("1-1-1", oExploitation.id)

    End Sub
    <TestMethod()> Public Sub WSSerialize()
        Dim oExploitation As New CRODIPWS.Exploitation()
        oExploitation.nomExploitant = "TU_MCO"
        Dim serializer As New XmlSerializer(oExploitation.GetType())
        Using writer As New StringWriter()
            serializer.Serialize(writer, oExploitation)
            Dim xmlOutput As String = writer.ToString()
            ' Vous pouvez maintenant vérifier ou envoyer cette chaîne sérialisée
            Trace.WriteLine(xmlOutput)
        End Using

    End Sub


End Class