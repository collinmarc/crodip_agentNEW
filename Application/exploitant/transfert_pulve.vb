Imports System.Collections.Generic
Imports CRODIPWS

Public Class transfert_pulve
    Inherits System.Windows.Forms.Form


#Region " - Vars - "
    Private m_Pulve As Pulverisateur
    Private m_ExploitOrigine As Exploitation
    Private m_Agent As Agent
    Private m_lstExploit As List(Of Exploitation)

    Friend WithEvents m_bsExploitation As System.Windows.Forms.BindingSource
    Friend WithEvents GroupBox1 As System.Windows.Forms.GroupBox
    Friend WithEvents GroupBox2 As System.Windows.Forms.GroupBox
    Friend WithEvents laTypePulve As System.Windows.Forms.Label
    Friend WithEvents Label117 As System.Windows.Forms.Label
    Friend WithEvents laMarquePulve As System.Windows.Forms.Label
    Friend WithEvents laNumNatPulve As System.Windows.Forms.Label
    Friend WithEvents Label3 As System.Windows.Forms.Label
    Friend WithEvents Label4 As System.Windows.Forms.Label
    Friend WithEvents list_clients As System.Windows.Forms.ListView
    Friend WithEvents listClients_col_siren As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_rs As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_prenom As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_nom As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_adresse As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_codePostal As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_commune As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_prochainControle As System.Windows.Forms.ColumnHeader
    Friend WithEvents btn_rechercher_exploitant As System.Windows.Forms.PictureBox
    Friend WithEvents list_search_fieldSearch As System.Windows.Forms.ComboBox
    Friend WithEvents client_search_query As System.Windows.Forms.TextBox
    Friend WithEvents btn_proprietaire_rechercher As System.Windows.Forms.Label
    Friend WithEvents btnTransferer As System.Windows.Forms.Button
    Friend WithEvents btnCancel As System.Windows.Forms.Button
    Friend WithEvents m_bsPulve As System.Windows.Forms.BindingSource
    Friend WithEvents LaNomExploitation As System.Windows.Forms.Label
    Friend WithEvents btnRetirer As Button
    Friend WithEvents pnlRechercheExploitation As Panel
    Friend WithEvents Label5 As Label
    Friend WithEvents Label2 As Label
    Friend WithEvents Label1 As Label
    Friend WithEvents Label6 As Label
    Friend WithEvents Label10 As Label
    Friend WithEvents Label9 As Label
    Friend WithEvents Label8 As Label
    Friend WithEvents Label7 As Label
    Friend WithEvents Label11 As Label
    Friend WithEvents laRaisonSociale As System.Windows.Forms.Label
#End Region

#Region " Code généré par le Concepteur Windows Form "

    Public Sub New()
        MyBase.New()

        'Cet appel est requis par le Concepteur Windows Form.
        InitializeComponent()

        'Ajoutez une initialisation quelconque après l'appel InitializeComponent()

    End Sub

    Public Sub New(pClient As Exploitation, pPulverisateur As Pulverisateur, pAgent As Agent, Optional pClientDestination As Exploitation = Nothing)
        Me.New()

        'Cet appel est requis par le Concepteur Windows Form.
        'InitializeComponent()

        'Ajoutez une initialisation quelconque après l'appel InitializeComponent()
        m_ExploitOrigine = pClient
        m_Pulve = pPulverisateur
        m_Agent = pAgent
        'S'il y a une exploitation d destination , i ln'y a pas de recherche
        If pClientDestination IsNot Nothing Then
            m_lstExploit = New List(Of Exploitation)
            m_lstExploit.Add(pClientDestination)
            AfficheListeExploitation()
            list_clients.SelectedIndices.Add(0) 'Selectionne automatiquement le premier element
            pnlRechercheExploitation.Visible = False
        End If

        m_bsExploitation.Add(m_ExploitOrigine)
        m_bsPulve.Add(m_Pulve)
        m_bsExploitation.ResetBindings(False)
        m_bsPulve.ResetBindings(False)

    End Sub


    'La méthode substituée Dispose du formulaire pour nettoyer la liste des composants.
    Protected Overloads Overrides Sub Dispose(ByVal disposing As Boolean)
        If disposing Then
            If Not (components Is Nothing) Then
                components.Dispose()
            End If
        End If
        MyBase.Dispose(disposing)
    End Sub

    'Requis par le Concepteur Windows Form
    Private components As System.ComponentModel.IContainer

    'REMARQUE : la procédure suivante est requise par le Concepteur Windows Form
    'Elle peut être modifiée en utilisant le Concepteur Windows Form.  
    'Ne la modifiez pas en utilisant l'éditeur de code.
    <System.Diagnostics.DebuggerStepThrough()> Private Sub InitializeComponent()
        Me.components = New System.ComponentModel.Container()
        Dim resources As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(transfert_pulve))
        Me.GroupBox1 = New System.Windows.Forms.GroupBox()
        Me.LaNomExploitation = New System.Windows.Forms.Label()
        Me.m_bsExploitation = New System.Windows.Forms.BindingSource(Me.components)
        Me.laRaisonSociale = New System.Windows.Forms.Label()
        Me.GroupBox2 = New System.Windows.Forms.GroupBox()
        Me.laTypePulve = New System.Windows.Forms.Label()
        Me.m_bsPulve = New System.Windows.Forms.BindingSource(Me.components)
        Me.Label117 = New System.Windows.Forms.Label()
        Me.laMarquePulve = New System.Windows.Forms.Label()
        Me.laNumNatPulve = New System.Windows.Forms.Label()
        Me.Label3 = New System.Windows.Forms.Label()
        Me.Label4 = New System.Windows.Forms.Label()
        Me.list_clients = New System.Windows.Forms.ListView()
        Me.listClients_col_siren = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_rs = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_prenom = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_nom = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_adresse = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_codePostal = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_commune = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_prochainControle = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.btn_rechercher_exploitant = New System.Windows.Forms.PictureBox()
        Me.list_search_fieldSearch = New System.Windows.Forms.ComboBox()
        Me.client_search_query = New System.Windows.Forms.TextBox()
        Me.btn_proprietaire_rechercher = New System.Windows.Forms.Label()
        Me.btnTransferer = New System.Windows.Forms.Button()
        Me.btnCancel = New System.Windows.Forms.Button()
        Me.btnRetirer = New System.Windows.Forms.Button()
        Me.pnlRechercheExploitation = New System.Windows.Forms.Panel()
        Me.Label1 = New System.Windows.Forms.Label()
        Me.Label2 = New System.Windows.Forms.Label()
        Me.Label5 = New System.Windows.Forms.Label()
        Me.Label6 = New System.Windows.Forms.Label()
        Me.Label7 = New System.Windows.Forms.Label()
        Me.Label8 = New System.Windows.Forms.Label()
        Me.Label9 = New System.Windows.Forms.Label()
        Me.Label10 = New System.Windows.Forms.Label()
        Me.Label11 = New System.Windows.Forms.Label()
        Me.GroupBox1.SuspendLayout()
        CType(Me.m_bsExploitation, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.GroupBox2.SuspendLayout()
        CType(Me.m_bsPulve, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.btn_rechercher_exploitant, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.pnlRechercheExploitation.SuspendLayout()
        Me.SuspendLayout()
        '
        'GroupBox1
        '
        Me.GroupBox1.Controls.Add(Me.Label10)
        Me.GroupBox1.Controls.Add(Me.Label9)
        Me.GroupBox1.Controls.Add(Me.LaNomExploitation)
        Me.GroupBox1.Controls.Add(Me.laRaisonSociale)
        Me.GroupBox1.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.GroupBox1.ForeColor = System.Drawing.Color.FromArgb(CType(CType(0, Byte), Integer), CType(CType(125, Byte), Integer), CType(CType(192, Byte), Integer))
        Me.GroupBox1.Location = New System.Drawing.Point(12, 12)
        Me.GroupBox1.Name = "GroupBox1"
        Me.GroupBox1.Size = New System.Drawing.Size(322, 122)
        Me.GroupBox1.TabIndex = 1
        Me.GroupBox1.TabStop = False
        Me.GroupBox1.Text = "Client Actuel"
        '
        'LaNomExploitation
        '
        Me.LaNomExploitation.AutoSize = True
        Me.LaNomExploitation.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "nomExploitant", True))
        Me.LaNomExploitation.Location = New System.Drawing.Point(16, 48)
        Me.LaNomExploitation.Name = "LaNomExploitation"
        Me.LaNomExploitation.Size = New System.Drawing.Size(32, 13)
        Me.LaNomExploitation.TabIndex = 1
        Me.LaNomExploitation.Text = "Nom"
        '
        'm_bsExploitation
        '
        Me.m_bsExploitation.DataSource = GetType(CRODIPWS.Exploitation)
        '
        'laRaisonSociale
        '
        Me.laRaisonSociale.AutoSize = True
        Me.laRaisonSociale.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "raisonSociale", True))
        Me.laRaisonSociale.Location = New System.Drawing.Point(16, 22)
        Me.laRaisonSociale.Name = "laRaisonSociale"
        Me.laRaisonSociale.Size = New System.Drawing.Size(90, 13)
        Me.laRaisonSociale.TabIndex = 0
        Me.laRaisonSociale.Text = "Raison sociale"
        '
        'GroupBox2
        '
        Me.GroupBox2.Controls.Add(Me.Label8)
        Me.GroupBox2.Controls.Add(Me.Label7)
        Me.GroupBox2.Controls.Add(Me.Label6)
        Me.GroupBox2.Controls.Add(Me.Label5)
        Me.GroupBox2.Controls.Add(Me.Label2)
        Me.GroupBox2.Controls.Add(Me.Label1)
        Me.GroupBox2.Controls.Add(Me.laTypePulve)
        Me.GroupBox2.Controls.Add(Me.Label117)
        Me.GroupBox2.Controls.Add(Me.laMarquePulve)
        Me.GroupBox2.Controls.Add(Me.laNumNatPulve)
        Me.GroupBox2.Controls.Add(Me.Label3)
        Me.GroupBox2.Controls.Add(Me.Label4)
        Me.GroupBox2.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.GroupBox2.ForeColor = System.Drawing.Color.FromArgb(CType(CType(0, Byte), Integer), CType(CType(125, Byte), Integer), CType(CType(192, Byte), Integer))
        Me.GroupBox2.Location = New System.Drawing.Point(518, 12)
        Me.GroupBox2.Name = "GroupBox2"
        Me.GroupBox2.Size = New System.Drawing.Size(312, 122)
        Me.GroupBox2.TabIndex = 2
        Me.GroupBox2.TabStop = False
        Me.GroupBox2.Text = "Pulvérisateur"
        '
        'laTypePulve
        '
        Me.laTypePulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "type", True))
        Me.laTypePulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laTypePulve.Location = New System.Drawing.Point(128, 62)
        Me.laTypePulve.Name = "laTypePulve"
        Me.laTypePulve.Size = New System.Drawing.Size(176, 16)
        Me.laTypePulve.TabIndex = 7
        Me.laTypePulve.Text = "Type Pulvé"
        '
        'm_bsPulve
        '
        Me.m_bsPulve.DataSource = GetType(CRODIPWS.Pulverisateur)
        '
        'Label117
        '
        Me.Label117.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label117.Location = New System.Drawing.Point(20, 62)
        Me.Label117.Name = "Label117"
        Me.Label117.Size = New System.Drawing.Size(104, 16)
        Me.Label117.TabIndex = 6
        Me.Label117.Text = "Type : "
        '
        'laMarquePulve
        '
        Me.laMarquePulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "marque", True))
        Me.laMarquePulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laMarquePulve.Location = New System.Drawing.Point(128, 30)
        Me.laMarquePulve.Name = "laMarquePulve"
        Me.laMarquePulve.Size = New System.Drawing.Size(176, 16)
        Me.laMarquePulve.TabIndex = 5
        Me.laMarquePulve.Text = "Marque Pulvé"
        '
        'laNumNatPulve
        '
        Me.laNumNatPulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "numeroNational", True))
        Me.laNumNatPulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laNumNatPulve.Location = New System.Drawing.Point(130, 14)
        Me.laNumNatPulve.Name = "laNumNatPulve"
        Me.laNumNatPulve.Size = New System.Drawing.Size(176, 16)
        Me.laNumNatPulve.TabIndex = 4
        Me.laNumNatPulve.Text = "Num pulvé"
        '
        'Label3
        '
        Me.Label3.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label3.Location = New System.Drawing.Point(20, 30)
        Me.Label3.Name = "Label3"
        Me.Label3.Size = New System.Drawing.Size(104, 16)
        Me.Label3.TabIndex = 1
        Me.Label3.Text = "Marque : "
        '
        'Label4
        '
        Me.Label4.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label4.Location = New System.Drawing.Point(20, 14)
        Me.Label4.Name = "Label4"
        Me.Label4.Size = New System.Drawing.Size(104, 16)
        Me.Label4.TabIndex = 0
        Me.Label4.Text = "Num. National : "
        '
        'list_clients
        '
        Me.list_clients.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
            Or System.Windows.Forms.AnchorStyles.Left) _
            Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
        Me.list_clients.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle
        Me.list_clients.Columns.AddRange(New System.Windows.Forms.ColumnHeader() {Me.listClients_col_siren, Me.listClients_col_rs, Me.listClients_col_prenom, Me.listClients_col_nom, Me.listClients_col_adresse, Me.listClients_col_codePostal, Me.listClients_col_commune, Me.listClients_col_prochainControle})
        Me.list_clients.FullRowSelect = True
        Me.list_clients.GridLines = True
        Me.list_clients.HideSelection = False
        Me.list_clients.Location = New System.Drawing.Point(12, 195)
        Me.list_clients.MultiSelect = False
        Me.list_clients.Name = "list_clients"
        Me.list_clients.Size = New System.Drawing.Size(827, 190)
        Me.list_clients.TabIndex = 9
        Me.list_clients.UseCompatibleStateImageBehavior = False
        Me.list_clients.View = System.Windows.Forms.View.Details
        '
        'listClients_col_siren
        '
        Me.listClients_col_siren.Text = "N° SIREN"
        Me.listClients_col_siren.Width = 86
        '
        'listClients_col_rs
        '
        Me.listClients_col_rs.Text = "Raison sociale"
        Me.listClients_col_rs.Width = 139
        '
        'listClients_col_prenom
        '
        Me.listClients_col_prenom.Text = "Prénom"
        Me.listClients_col_prenom.Width = 98
        '
        'listClients_col_nom
        '
        Me.listClients_col_nom.Text = "Nom"
        Me.listClients_col_nom.Width = 100
        '
        'listClients_col_adresse
        '
        Me.listClients_col_adresse.Text = "Adresse"
        Me.listClients_col_adresse.Width = 293
        '
        'listClients_col_codePostal
        '
        Me.listClients_col_codePostal.Text = "Code Postal"
        Me.listClients_col_codePostal.Width = 78
        '
        'listClients_col_commune
        '
        Me.listClients_col_commune.Text = "Commune"
        Me.listClients_col_commune.Width = 84
        '
        'listClients_col_prochainControle
        '
        Me.listClients_col_prochainControle.Text = "Dernier contrôle"
        Me.listClients_col_prochainControle.Width = 95
        '
        'btn_rechercher_exploitant
        '
        Me.btn_rechercher_exploitant.Image = CType(resources.GetObject("btn_rechercher_exploitant.Image"), System.Drawing.Image)
        Me.btn_rechercher_exploitant.Location = New System.Drawing.Point(3, 3)
        Me.btn_rechercher_exploitant.Name = "btn_rechercher_exploitant"
        Me.btn_rechercher_exploitant.Size = New System.Drawing.Size(16, 16)
        Me.btn_rechercher_exploitant.TabIndex = 25
        Me.btn_rechercher_exploitant.TabStop = False
        '
        'list_search_fieldSearch
        '
        Me.list_search_fieldSearch.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList
        Me.list_search_fieldSearch.Location = New System.Drawing.Point(329, 3)
        Me.list_search_fieldSearch.Name = "list_search_fieldSearch"
        Me.list_search_fieldSearch.Size = New System.Drawing.Size(121, 21)
        Me.list_search_fieldSearch.TabIndex = 24
        '
        'client_search_query
        '
        Me.client_search_query.Location = New System.Drawing.Point(25, 3)
        Me.client_search_query.Name = "client_search_query"
        Me.client_search_query.Size = New System.Drawing.Size(298, 20)
        Me.client_search_query.TabIndex = 23
        '
        'btn_proprietaire_rechercher
        '
        Me.btn_proprietaire_rechercher.Anchor = CType((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
        Me.btn_proprietaire_rechercher.Cursor = System.Windows.Forms.Cursors.Hand
        Me.btn_proprietaire_rechercher.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.btn_proprietaire_rechercher.ForeColor = System.Drawing.Color.White
        Me.btn_proprietaire_rechercher.Image = CType(resources.GetObject("btn_proprietaire_rechercher.Image"), System.Drawing.Image)
        Me.btn_proprietaire_rechercher.Location = New System.Drawing.Point(696, 3)
        Me.btn_proprietaire_rechercher.Name = "btn_proprietaire_rechercher"
        Me.btn_proprietaire_rechercher.Size = New System.Drawing.Size(128, 24)
        Me.btn_proprietaire_rechercher.TabIndex = 26
        Me.btn_proprietaire_rechercher.Text = "     Rechercher"
        Me.btn_proprietaire_rechercher.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
        '
        'btnTransferer
        '
        Me.btnTransferer.BackgroundImage = Global.Crodip_agent.Resources.btn_empty
        Me.btnTransferer.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Center
        Me.btnTransferer.Cursor = System.Windows.Forms.Cursors.Hand
        Me.btnTransferer.FlatAppearance.BorderColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnTransferer.FlatAppearance.BorderSize = 0
        Me.btnTransferer.FlatAppearance.MouseDownBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnTransferer.FlatAppearance.MouseOverBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnTransferer.FlatStyle = System.Windows.Forms.FlatStyle.Flat
        Me.btnTransferer.ForeColor = System.Drawing.Color.White
        Me.btnTransferer.Location = New System.Drawing.Point(339, 391)
        Me.btnTransferer.Name = "btnTransferer"
        Me.btnTransferer.Size = New System.Drawing.Size(140, 29)
        Me.btnTransferer.TabIndex = 27
        Me.btnTransferer.Text = "Transférer"
        Me.btnTransferer.UseVisualStyleBackColor = False
        '
        'btnCancel
        '
        Me.btnCancel.BackgroundImage = Global.Crodip_agent.Resources.btn_annuler
        Me.btnCancel.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Center
        Me.btnCancel.Cursor = System.Windows.Forms.Cursors.Hand
        Me.btnCancel.DialogResult = System.Windows.Forms.DialogResult.Cancel
        Me.btnCancel.FlatAppearance.BorderSize = 0
        Me.btnCancel.FlatAppearance.MouseDownBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnCancel.FlatAppearance.MouseOverBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnCancel.FlatStyle = System.Windows.Forms.FlatStyle.Flat
        Me.btnCancel.ForeColor = System.Drawing.Color.White
        Me.btnCancel.Location = New System.Drawing.Point(700, 391)
        Me.btnCancel.Name = "btnCancel"
        Me.btnCancel.Size = New System.Drawing.Size(133, 29)
        Me.btnCancel.TabIndex = 28
        Me.btnCancel.Text = "Annuler"
        Me.btnCancel.UseVisualStyleBackColor = True
        '
        'btnRetirer
        '
        Me.btnRetirer.BackgroundImage = Global.Crodip_agent.Resources.btn_empty
        Me.btnRetirer.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Center
        Me.btnRetirer.Cursor = System.Windows.Forms.Cursors.Hand
        Me.btnRetirer.FlatAppearance.BorderColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnRetirer.FlatAppearance.BorderSize = 0
        Me.btnRetirer.FlatAppearance.MouseDownBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnRetirer.FlatAppearance.MouseOverBackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.btnRetirer.FlatStyle = System.Windows.Forms.FlatStyle.Flat
        Me.btnRetirer.ForeColor = System.Drawing.Color.White
        Me.btnRetirer.Location = New System.Drawing.Point(181, 391)
        Me.btnRetirer.Name = "btnRetirer"
        Me.btnRetirer.Size = New System.Drawing.Size(140, 29)
        Me.btnRetirer.TabIndex = 29
        Me.btnRetirer.Text = "Retirer"
        Me.btnRetirer.UseVisualStyleBackColor = False
        '
        'pnlRechercheExploitation
        '
        Me.pnlRechercheExploitation.Anchor = CType(((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Left) _
            Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
        Me.pnlRechercheExploitation.Controls.Add(Me.btn_rechercher_exploitant)
        Me.pnlRechercheExploitation.Controls.Add(Me.client_search_query)
        Me.pnlRechercheExploitation.Controls.Add(Me.list_search_fieldSearch)
        Me.pnlRechercheExploitation.Controls.Add(Me.btn_proprietaire_rechercher)
        Me.pnlRechercheExploitation.Location = New System.Drawing.Point(12, 140)
        Me.pnlRechercheExploitation.Name = "pnlRechercheExploitation"
        Me.pnlRechercheExploitation.Size = New System.Drawing.Size(827, 36)
        Me.pnlRechercheExploitation.TabIndex = 30
        '
        'Label1
        '
        Me.Label1.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label1.Location = New System.Drawing.Point(20, 78)
        Me.Label1.Name = "Label1"
        Me.Label1.Size = New System.Drawing.Size(104, 16)
        Me.Label1.TabIndex = 8
        Me.Label1.Text = "Catégorie : "
        '
        'Label2
        '
        Me.Label2.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "categorie", True))
        Me.Label2.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label2.Location = New System.Drawing.Point(128, 78)
        Me.Label2.Name = "Label2"
        Me.Label2.Size = New System.Drawing.Size(176, 16)
        Me.Label2.TabIndex = 9
        Me.Label2.Text = "categorie Pulvé"
        '
        'Label5
        '
        Me.Label5.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label5.Location = New System.Drawing.Point(20, 94)
        Me.Label5.Name = "Label5"
        Me.Label5.Size = New System.Drawing.Size(104, 16)
        Me.Label5.TabIndex = 10
        Me.Label5.Text = "Immatriculation : "
        '
        'Label6
        '
        Me.Label6.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "immatPlaque", True))
        Me.Label6.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label6.Location = New System.Drawing.Point(128, 94)
        Me.Label6.Name = "Label6"
        Me.Label6.Size = New System.Drawing.Size(176, 16)
        Me.Label6.TabIndex = 11
        Me.Label6.Text = "Immatriculation"
        '
        'Label7
        '
        Me.Label7.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "modele", True))
        Me.Label7.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label7.Location = New System.Drawing.Point(130, 45)
        Me.Label7.Name = "Label7"
        Me.Label7.Size = New System.Drawing.Size(104, 16)
        Me.Label7.TabIndex = 12
        Me.Label7.Text = "Modèle pulvé : "
        '
        'Label8
        '
        Me.Label8.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label8.Location = New System.Drawing.Point(20, 45)
        Me.Label8.Name = "Label8"
        Me.Label8.Size = New System.Drawing.Size(104, 16)
        Me.Label8.TabIndex = 13
        Me.Label8.Text = "Modèle : "
        '
        'Label9
        '
        Me.Label9.AutoSize = True
        Me.Label9.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "codePostal", True))
        Me.Label9.Location = New System.Drawing.Point(16, 65)
        Me.Label9.Name = "Label9"
        Me.Label9.Size = New System.Drawing.Size(74, 13)
        Me.Label9.TabIndex = 2
        Me.Label9.Text = "Code postal"
        '
        'Label10
        '
        Me.Label10.AutoSize = True
        Me.Label10.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "commune", True))
        Me.Label10.Location = New System.Drawing.Point(107, 65)
        Me.Label10.Name = "Label10"
        Me.Label10.Size = New System.Drawing.Size(61, 13)
        Me.Label10.TabIndex = 3
        Me.Label10.Text = "Commune"
        '
        'Label11
        '
        Me.Label11.AutoSize = True
        Me.Label11.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Bold)
        Me.Label11.ForeColor = System.Drawing.Color.FromArgb(CType(CType(0, Byte), Integer), CType(CType(125, Byte), Integer), CType(CType(192, Byte), Integer))
        Me.Label11.Location = New System.Drawing.Point(9, 179)
        Me.Label11.Name = "Label11"
        Me.Label11.Size = New System.Drawing.Size(94, 13)
        Me.Label11.TabIndex = 31
        Me.Label11.Text = "Nouveau Client"
        '
        'transfert_pulve
        '
        Me.AcceptButton = Me.btnTransferer
        Me.AutoScaleBaseSize = New System.Drawing.Size(5, 13)
        Me.BackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.CancelButton = Me.btnCancel
        Me.ClientSize = New System.Drawing.Size(842, 432)
        Me.Controls.Add(Me.Label11)
        Me.Controls.Add(Me.pnlRechercheExploitation)
        Me.Controls.Add(Me.btnRetirer)
        Me.Controls.Add(Me.btnCancel)
        Me.Controls.Add(Me.btnTransferer)
        Me.Controls.Add(Me.list_clients)
        Me.Controls.Add(Me.GroupBox2)
        Me.Controls.Add(Me.GroupBox1)
        Me.Name = "transfert_pulve"
        Me.ShowInTaskbar = False
        Me.StartPosition = System.Windows.Forms.FormStartPosition.CenterScreen
        Me.TopMost = True
        Me.GroupBox1.ResumeLayout(False)
        Me.GroupBox1.PerformLayout()
        CType(Me.m_bsExploitation, System.ComponentModel.ISupportInitialize).EndInit()
        Me.GroupBox2.ResumeLayout(False)
        CType(Me.m_bsPulve, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.btn_rechercher_exploitant, System.ComponentModel.ISupportInitialize).EndInit()
        Me.pnlRechercheExploitation.ResumeLayout(False)
        Me.pnlRechercheExploitation.PerformLayout()
        Me.ResumeLayout(False)
        Me.PerformLayout()

    End Sub

#End Region

    Private Sub transfert_pulve_Load(sender As Object, e As EventArgs) Handles Me.Load
        Dim objComboItem_Tous As New objComboItem("0", "Tous")
        Dim objComboItem_SIREN As New objComboItem("1", "N° SIREN")
        Dim objComboItem_RS As New objComboItem("2", "Raison Sociale")
        Dim objComboItem_Prenom As New objComboItem("3", "Prénom")
        Dim objComboItem_Nom As New objComboItem("4", "Nom")
        Dim objComboItem_DateC As New objComboItem("5", "Date de controle")
        list_search_fieldSearch.Items.Add(objComboItem_Tous)
        list_search_fieldSearch.Items.Add(objComboItem_SIREN)
        list_search_fieldSearch.Items.Add(objComboItem_RS)
        list_search_fieldSearch.Items.Add(objComboItem_Prenom)
        list_search_fieldSearch.Items.Add(objComboItem_Nom)
        list_search_fieldSearch.Items.Add(objComboItem_DateC)
        list_search_fieldSearch.SelectedIndex = 0
        If Not GlobalsCRODIP.GLOB_ENV_MODEFORMATION Then
            Me.Text = "Crodip .::. Transfert pulverisateur"
        Else
            Me.Text = "Transfert pulverisateur"
        End If

        If (m_Pulve IsNot Nothing) Then
            Dim nExploitReliee As Integer = 0
            nExploitReliee = ExploitationTOPulverisateurManager.getListByPulverisateurId(m_Pulve.id).Count()
            If nExploitReliee < 2 Then
                btnRetirer.Visible = False
            Else
                btnRetirer.Visible = True
            End If

        End If

    End Sub

    Private Sub btn_proprietaire_rechercher_Click(sender As Object, e As EventArgs) Handles btn_proprietaire_rechercher.Click
        searchExploitant()
    End Sub
    Private Sub searchExploitant()
        Dim searchId As Integer
        Dim searchCriteria As String

        If list_search_fieldSearch.SelectedItem IsNot Nothing Then
            searchId = list_search_fieldSearch.SelectedItem.id
            searchCriteria = client_search_query.Text
            m_lstExploit = ExploitationManager.searchExploitation(m_Agent, searchId, searchCriteria)
            AfficheListeExploitation()
        End If


    End Sub

    Private Sub AfficheListeExploitation()
        ' On récupère la liste des profils locaux
        Dim intCount As Decimal = 0
        Dim oExploit As Exploitation

        list_clients.Items.Clear()
        For Each oExploit In m_lstExploit
            list_clients.Items.Add(oExploit.numeroSiren) ' SIREN
            list_clients.Items(CInt(intCount)).Tag = oExploit.id
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.raisonSociale) 'RS
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.prenomExploitant) ' Prénom
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.nomExploitant) ' Nom
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.adresse) ' Adresse
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.codePostal) ' Code postal
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.commune) ' Commune
            If oExploit.dateDernierControle <> "" And oExploit.dateDernierControle <> "30/12/1899 00:00:00" Then
                Dim tmpDateNextDiag As Date = oExploit.dateDernierControle
                list_clients.Items(CInt(intCount)).SubItems.Add(tmpDateNextDiag.ToShortDateString)  ' Dernier contrôle
            Else
                list_clients.Items(CInt(intCount)).SubItems.Add("")  ' Dernier contrôle
            End If
            list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.nPulvesAlerte) ' Nbre de pulvé en alerte
            '                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.id) ' IDExploitation

            ' Détection des alertes
            If oExploit.nPulvesAlerte > 0 Then
                list_clients.Items(CInt(intCount)).BackColor = System.Drawing.Color.LightBlue
                list_clients.Items(CInt(intCount)).ForeColor = System.Drawing.Color.Black
            End If

            intCount = intCount + 1

        Next oExploit

    End Sub

    Private Sub btnTransferer_Click(sender As Object, e As EventArgs) Handles btnTransferer.Click
        TransfertPulve()
    End Sub

    Private Sub TransfertPulve()
        If list_clients.SelectedItems.Count = 1 Then
            'Recupération du client
            Dim oExploitCible As Exploitation
            Dim ExploitId As String
            ExploitId = list_clients.SelectedItems(0).Tag
            oExploitCible = ExploitationManager.getExploitationById(ExploitId)
            ' On informe l'utilisateur et on lui demande confirmation
            If MsgBox("Attention, vous allez transferer le pulverisateur N° " & m_Pulve.numeroNational & " de l'exploitation " & m_ExploitOrigine.raisonSociale & " vers l'exploitation " & oExploitCible.raisonSociale & ",Etes-vous sûr ?", MsgBoxStyle.YesNo, "Transfert d'un pulvérisateur") = MsgBoxResult.Yes Then
                m_Pulve.TransfertPulve(m_ExploitOrigine, oExploitCible, m_Agent)
                Me.DialogResult = DialogResult.OK
                Me.Close()
            End If
        End If
    End Sub

    Private Sub btnRetirer_Click(sender As Object, e As EventArgs) Handles btnRetirer.Click
        'Le Bouton est invisble d'un l'y a Qu'un propriétaire
        'juste pour être sur
        Dim nExploitReliee As Integer = 0
        nExploitReliee = ExploitationTOPulverisateurManager.getListByPulverisateurId(m_Pulve.id).Count()
        If nExploitReliee < 2 Then
            MsgBox("Vous ne pouvez retirer un pulvérisateur qui n'appartient qu'à un propritétaire")
            Exit Sub
        Else
            Dim oExploit2Pulve As ExploitationTOPulverisateur
            oExploit2Pulve = ExploitationTOPulverisateurManager.getListByPulverisateurId(m_Pulve.id).Find(Function(E2p)
                                                                                                              Return E2p.id = m_ExploitOrigine.id
                                                                                                          End Function)
            oExploit2Pulve.isSupprimeCoProp = True
            ExploitationTOPulverisateurManager.save(oExploit2Pulve, m_Agent)
        End If
        Me.Close()


    End Sub
End Class