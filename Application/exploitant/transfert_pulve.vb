Imports System.Collections.Generic
Public Class transfert_pulve
    Inherits System.Windows.Forms.Form


#Region " - Vars - "
    Private m_Pulve As Pulverisateur
    Private m_ExploitOrigine As Exploitation
    Private m_Agent As Agent

    Friend WithEvents m_bsExploitation As System.Windows.Forms.BindingSource
    Friend WithEvents GroupBox1 As System.Windows.Forms.GroupBox
    Friend WithEvents GroupBox2 As System.Windows.Forms.GroupBox
    Friend WithEvents laTypePulve As System.Windows.Forms.Label
    Friend WithEvents Label117 As System.Windows.Forms.Label
    Friend WithEvents laMarcquePulve As System.Windows.Forms.Label
    Friend WithEvents laNumNatPulve As System.Windows.Forms.Label
    Friend WithEvents Label3 As System.Windows.Forms.Label
    Friend WithEvents Label4 As System.Windows.Forms.Label
    Friend WithEvents list_clients As System.Windows.Forms.ListView
    Friend WithEvents listClients_col_siren As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_rs As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_prenom As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_nom As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_adresse As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_codePostal As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_commune As System.Windows.Forms.ColumnHeader
    Friend WithEvents listClients_col_prochainControle As System.Windows.Forms.ColumnHeader
    Friend WithEvents btn_rechercher_exploitant As System.Windows.Forms.PictureBox
    Friend WithEvents list_search_fieldSearch As System.Windows.Forms.ComboBox
    Friend WithEvents client_search_query As System.Windows.Forms.TextBox
    Friend WithEvents btn_proprietaire_rechercher As System.Windows.Forms.Label
    Friend WithEvents btnTransferer As System.Windows.Forms.Button
    Friend WithEvents btnCancel As System.Windows.Forms.Button
    Friend WithEvents m_bsPulve As System.Windows.Forms.BindingSource
    Friend WithEvents LaNomExploitation As System.Windows.Forms.Label
    Friend WithEvents laRaisonSociale As System.Windows.Forms.Label
#End Region

#Region " Code généré par le Concepteur Windows Form "

    Public Sub New()
        MyBase.New()

        'Cet appel est requis par le Concepteur Windows Form.
        InitializeComponent()

        'Ajoutez une initialisation quelconque après l'appel InitializeComponent()

    End Sub

    Public Sub New(pClient As Exploitation, pPulverisateur As Pulverisateur, pAgent As Agent)
        Me.New()

        'Cet appel est requis par le Concepteur Windows Form.
        'InitializeComponent()

        'Ajoutez une initialisation quelconque après l'appel InitializeComponent()
        m_ExploitOrigine = pClient
        m_Pulve = pPulverisateur
        m_Agent = pAgent

        m_bsExploitation.Add(m_ExploitOrigine)
        m_bsPulve.Add(m_Pulve)
        m_bsExploitation.ResetBindings(False)
        m_bsPulve.ResetBindings(False)

    End Sub


    'La méthode substituée Dispose du formulaire pour nettoyer la liste des composants.
    Protected Overloads Overrides Sub Dispose(ByVal disposing As Boolean)
        If disposing Then
            If Not (components Is Nothing) Then
                components.Dispose()
            End If
        End If
        MyBase.Dispose(disposing)
    End Sub

    'Requis par le Concepteur Windows Form
    Private components As System.ComponentModel.IContainer

    'REMARQUE : la procédure suivante est requise par le Concepteur Windows Form
    'Elle peut être modifiée en utilisant le Concepteur Windows Form.  
    'Ne la modifiez pas en utilisant l'éditeur de code.
    <System.Diagnostics.DebuggerStepThrough()> Private Sub InitializeComponent()
        Me.components = New System.ComponentModel.Container()
        Dim resources As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(transfert_pulve))
        Me.GroupBox1 = New System.Windows.Forms.GroupBox()
        Me.LaNomExploitation = New System.Windows.Forms.Label()
        Me.m_bsExploitation = New System.Windows.Forms.BindingSource(Me.components)
        Me.laRaisonSociale = New System.Windows.Forms.Label()
        Me.GroupBox2 = New System.Windows.Forms.GroupBox()
        Me.laTypePulve = New System.Windows.Forms.Label()
        Me.m_bsPulve = New System.Windows.Forms.BindingSource(Me.components)
        Me.Label117 = New System.Windows.Forms.Label()
        Me.laMarcquePulve = New System.Windows.Forms.Label()
        Me.laNumNatPulve = New System.Windows.Forms.Label()
        Me.Label3 = New System.Windows.Forms.Label()
        Me.Label4 = New System.Windows.Forms.Label()
        Me.list_clients = New System.Windows.Forms.ListView()
        Me.listClients_col_siren = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_rs = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_prenom = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_nom = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_adresse = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_codePostal = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_commune = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.listClients_col_prochainControle = CType(New System.Windows.Forms.ColumnHeader(), System.Windows.Forms.ColumnHeader)
        Me.btn_rechercher_exploitant = New System.Windows.Forms.PictureBox()
        Me.list_search_fieldSearch = New System.Windows.Forms.ComboBox()
        Me.client_search_query = New System.Windows.Forms.TextBox()
        Me.btn_proprietaire_rechercher = New System.Windows.Forms.Label()
        Me.btnTransferer = New System.Windows.Forms.Button()
        Me.btnCancel = New System.Windows.Forms.Button()
        Me.GroupBox1.SuspendLayout()
        CType(Me.m_bsExploitation, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.GroupBox2.SuspendLayout()
        CType(Me.m_bsPulve, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.btn_rechercher_exploitant, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.SuspendLayout()
        '
        'GroupBox1
        '
        Me.GroupBox1.Controls.Add(Me.LaNomExploitation)
        Me.GroupBox1.Controls.Add(Me.laRaisonSociale)
        Me.GroupBox1.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.GroupBox1.ForeColor = System.Drawing.Color.FromArgb(CType(CType(0, Byte), Integer), CType(CType(125, Byte), Integer), CType(CType(192, Byte), Integer))
        Me.GroupBox1.Location = New System.Drawing.Point(12, 12)
        Me.GroupBox1.Name = "GroupBox1"
        Me.GroupBox1.Size = New System.Drawing.Size(322, 69)
        Me.GroupBox1.TabIndex = 1
        Me.GroupBox1.TabStop = False
        Me.GroupBox1.Text = "Client Actuel"
        '
        'LaNomExploitation
        '
        Me.LaNomExploitation.AutoSize = True
        Me.LaNomExploitation.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "nomExploitant", True))
        Me.LaNomExploitation.Location = New System.Drawing.Point(16, 48)
        Me.LaNomExploitation.Name = "LaNomExploitation"
        Me.LaNomExploitation.Size = New System.Drawing.Size(45, 13)
        Me.LaNomExploitation.TabIndex = 1
        Me.LaNomExploitation.Text = "Label1"
        '
        'm_bsExploitation
        '
        Me.m_bsExploitation.DataSource = GetType(Crodip_agent.Exploitation)
        '
        'laRaisonSociale
        '
        Me.laRaisonSociale.AutoSize = True
        Me.laRaisonSociale.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsExploitation, "raisonSociale", True))
        Me.laRaisonSociale.Location = New System.Drawing.Point(16, 22)
        Me.laRaisonSociale.Name = "laRaisonSociale"
        Me.laRaisonSociale.Size = New System.Drawing.Size(45, 13)
        Me.laRaisonSociale.TabIndex = 0
        Me.laRaisonSociale.Text = "Label1"
        '
        'GroupBox2
        '
        Me.GroupBox2.Controls.Add(Me.laTypePulve)
        Me.GroupBox2.Controls.Add(Me.Label117)
        Me.GroupBox2.Controls.Add(Me.laMarcquePulve)
        Me.GroupBox2.Controls.Add(Me.laNumNatPulve)
        Me.GroupBox2.Controls.Add(Me.Label3)
        Me.GroupBox2.Controls.Add(Me.Label4)
        Me.GroupBox2.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.GroupBox2.ForeColor = System.Drawing.Color.FromArgb(CType(CType(0, Byte), Integer), CType(CType(125, Byte), Integer), CType(CType(192, Byte), Integer))
        Me.GroupBox2.Location = New System.Drawing.Point(518, 12)
        Me.GroupBox2.Name = "GroupBox2"
        Me.GroupBox2.Size = New System.Drawing.Size(312, 69)
        Me.GroupBox2.TabIndex = 2
        Me.GroupBox2.TabStop = False
        Me.GroupBox2.Text = "Pulvérisateur"
        '
        'laTypePulve
        '
        Me.laTypePulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "type", True))
        Me.laTypePulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laTypePulve.Location = New System.Drawing.Point(128, 48)
        Me.laTypePulve.Name = "laTypePulve"
        Me.laTypePulve.Size = New System.Drawing.Size(176, 16)
        Me.laTypePulve.TabIndex = 7
        Me.laTypePulve.Text = "Type Pulvé"
        '
        'm_bsPulve
        '
        Me.m_bsPulve.DataSource = GetType(Crodip_agent.Pulverisateur)
        '
        'Label117
        '
        Me.Label117.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label117.Location = New System.Drawing.Point(20, 48)
        Me.Label117.Name = "Label117"
        Me.Label117.Size = New System.Drawing.Size(104, 16)
        Me.Label117.TabIndex = 6
        Me.Label117.Text = "Type Pulvé : "
        '
        'laMarcquePulve
        '
        Me.laMarcquePulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "marque", True))
        Me.laMarcquePulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laMarcquePulve.Location = New System.Drawing.Point(128, 30)
        Me.laMarcquePulve.Name = "laMarcquePulve"
        Me.laMarcquePulve.Size = New System.Drawing.Size(176, 16)
        Me.laMarcquePulve.TabIndex = 5
        Me.laMarcquePulve.Text = "Marque-Modèle Pulvé"
        '
        'laNumNatPulve
        '
        Me.laNumNatPulve.DataBindings.Add(New System.Windows.Forms.Binding("Text", Me.m_bsPulve, "numeroNational", True))
        Me.laNumNatPulve.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.laNumNatPulve.Location = New System.Drawing.Point(130, 14)
        Me.laNumNatPulve.Name = "laNumNatPulve"
        Me.laNumNatPulve.Size = New System.Drawing.Size(176, 16)
        Me.laNumNatPulve.TabIndex = 4
        Me.laNumNatPulve.Text = "Num pulvé"
        '
        'Label3
        '
        Me.Label3.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label3.Location = New System.Drawing.Point(20, 30)
        Me.Label3.Name = "Label3"
        Me.Label3.Size = New System.Drawing.Size(104, 16)
        Me.Label3.TabIndex = 1
        Me.Label3.Text = "Marque modèle : "
        '
        'Label4
        '
        Me.Label4.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.25!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.Label4.Location = New System.Drawing.Point(20, 14)
        Me.Label4.Name = "Label4"
        Me.Label4.Size = New System.Drawing.Size(104, 16)
        Me.Label4.TabIndex = 0
        Me.Label4.Text = "Num. National : "
        '
        'list_clients
        '
        Me.list_clients.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
            Or System.Windows.Forms.AnchorStyles.Left) _
            Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
        Me.list_clients.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle
        Me.list_clients.Columns.AddRange(New System.Windows.Forms.ColumnHeader() {Me.listClients_col_siren, Me.listClients_col_rs, Me.listClients_col_prenom, Me.listClients_col_nom, Me.listClients_col_adresse, Me.listClients_col_codePostal, Me.listClients_col_commune, Me.listClients_col_prochainControle})
        Me.list_clients.FullRowSelect = True
        Me.list_clients.GridLines = True
        Me.list_clients.HideSelection = False
        Me.list_clients.Location = New System.Drawing.Point(12, 129)
        Me.list_clients.MultiSelect = False
        Me.list_clients.Name = "list_clients"
        Me.list_clients.Size = New System.Drawing.Size(827, 211)
        Me.list_clients.TabIndex = 9
        Me.list_clients.UseCompatibleStateImageBehavior = False
        Me.list_clients.View = System.Windows.Forms.View.Details
        '
        'listClients_col_siren
        '
        Me.listClients_col_siren.Text = "N° SIREN"
        Me.listClients_col_siren.Width = 86
        '
        'listClients_col_rs
        '
        Me.listClients_col_rs.Text = "Raison sociale"
        Me.listClients_col_rs.Width = 139
        '
        'listClients_col_prenom
        '
        Me.listClients_col_prenom.Text = "Prénom"
        Me.listClients_col_prenom.Width = 98
        '
        'listClients_col_nom
        '
        Me.listClients_col_nom.Text = "Nom"
        Me.listClients_col_nom.Width = 100
        '
        'listClients_col_adresse
        '
        Me.listClients_col_adresse.Text = "Adresse"
        Me.listClients_col_adresse.Width = 293
        '
        'listClients_col_codePostal
        '
        Me.listClients_col_codePostal.Text = "Code Postal"
        Me.listClients_col_codePostal.Width = 78
        '
        'listClients_col_commune
        '
        Me.listClients_col_commune.Text = "Commune"
        Me.listClients_col_commune.Width = 84
        '
        'listClients_col_prochainControle
        '
        Me.listClients_col_prochainControle.Text = "Dernier contrôle"
        Me.listClients_col_prochainControle.Width = 95
        '
        'btn_rechercher_exploitant
        '
        Me.btn_rechercher_exploitant.Image = CType(resources.GetObject("btn_rechercher_exploitant.Image"), System.Drawing.Image)
        Me.btn_rechercher_exploitant.Location = New System.Drawing.Point(12, 88)
        Me.btn_rechercher_exploitant.Name = "btn_rechercher_exploitant"
        Me.btn_rechercher_exploitant.Size = New System.Drawing.Size(16, 16)
        Me.btn_rechercher_exploitant.TabIndex = 25
        Me.btn_rechercher_exploitant.TabStop = False
        '
        'list_search_fieldSearch
        '
        Me.list_search_fieldSearch.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList
        Me.list_search_fieldSearch.Location = New System.Drawing.Point(340, 87)
        Me.list_search_fieldSearch.Name = "list_search_fieldSearch"
        Me.list_search_fieldSearch.Size = New System.Drawing.Size(121, 21)
        Me.list_search_fieldSearch.TabIndex = 24
        '
        'client_search_query
        '
        Me.client_search_query.Location = New System.Drawing.Point(36, 87)
        Me.client_search_query.Name = "client_search_query"
        Me.client_search_query.Size = New System.Drawing.Size(298, 20)
        Me.client_search_query.TabIndex = 23
        '
        'btn_proprietaire_rechercher
        '
        Me.btn_proprietaire_rechercher.Cursor = System.Windows.Forms.Cursors.Hand
        Me.btn_proprietaire_rechercher.Font = New System.Drawing.Font("Microsoft Sans Serif", 8.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
        Me.btn_proprietaire_rechercher.ForeColor = System.Drawing.Color.White
        Me.btn_proprietaire_rechercher.Image = CType(resources.GetObject("btn_proprietaire_rechercher.Image"), System.Drawing.Image)
        Me.btn_proprietaire_rechercher.Location = New System.Drawing.Point(702, 88)
        Me.btn_proprietaire_rechercher.Name = "btn_proprietaire_rechercher"
        Me.btn_proprietaire_rechercher.Size = New System.Drawing.Size(128, 24)
        Me.btn_proprietaire_rechercher.TabIndex = 26
        Me.btn_proprietaire_rechercher.Text = "     Rechercher"
        Me.btn_proprietaire_rechercher.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
        '
        'btnTransferer
        '
        Me.btnTransferer.BackgroundImage = Global.Crodip_agent.Resources.btn_login
        Me.btnTransferer.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Stretch
        Me.btnTransferer.FlatAppearance.BorderSize = 0
        Me.btnTransferer.FlatStyle = System.Windows.Forms.FlatStyle.Flat
        Me.btnTransferer.ForeColor = System.Drawing.Color.White
        Me.btnTransferer.Location = New System.Drawing.Point(336, 361)
        Me.btnTransferer.Name = "btnTransferer"
        Me.btnTransferer.Size = New System.Drawing.Size(133, 29)
        Me.btnTransferer.TabIndex = 27
        Me.btnTransferer.Text = "Transférer"
        Me.btnTransferer.UseVisualStyleBackColor = True
        '
        'btnCancel
        '
        Me.btnCancel.BackgroundImage = Global.Crodip_agent.Resources.btn_annuler
        Me.btnCancel.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Stretch
        Me.btnCancel.DialogResult = System.Windows.Forms.DialogResult.Cancel
        Me.btnCancel.FlatAppearance.BorderSize = 0
        Me.btnCancel.FlatStyle = System.Windows.Forms.FlatStyle.Flat
        Me.btnCancel.ForeColor = System.Drawing.Color.White
        Me.btnCancel.Location = New System.Drawing.Point(697, 361)
        Me.btnCancel.Name = "btnCancel"
        Me.btnCancel.Size = New System.Drawing.Size(133, 29)
        Me.btnCancel.TabIndex = 28
        Me.btnCancel.Text = "Annuler"
        Me.btnCancel.UseVisualStyleBackColor = True
        '
        'transfert_pulve
        '
        Me.AcceptButton = Me.btnTransferer
        Me.AutoScaleBaseSize = New System.Drawing.Size(5, 13)
        Me.BackColor = System.Drawing.Color.FromArgb(CType(CType(234, Byte), Integer), CType(CType(234, Byte), Integer), CType(CType(236, Byte), Integer))
        Me.CancelButton = Me.btnCancel
        Me.ClientSize = New System.Drawing.Size(842, 432)
        Me.Controls.Add(Me.btnCancel)
        Me.Controls.Add(Me.btnTransferer)
        Me.Controls.Add(Me.btn_rechercher_exploitant)
        Me.Controls.Add(Me.list_search_fieldSearch)
        Me.Controls.Add(Me.client_search_query)
        Me.Controls.Add(Me.btn_proprietaire_rechercher)
        Me.Controls.Add(Me.list_clients)
        Me.Controls.Add(Me.GroupBox2)
        Me.Controls.Add(Me.GroupBox1)
        Me.Name = "transfert_pulve"
        Me.ShowInTaskbar = False
        Me.StartPosition = System.Windows.Forms.FormStartPosition.CenterScreen
        Me.TopMost = True
        Me.GroupBox1.ResumeLayout(False)
        Me.GroupBox1.PerformLayout()
        CType(Me.m_bsExploitation, System.ComponentModel.ISupportInitialize).EndInit()
        Me.GroupBox2.ResumeLayout(False)
        CType(Me.m_bsPulve, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.btn_rechercher_exploitant, System.ComponentModel.ISupportInitialize).EndInit()
        Me.ResumeLayout(False)
        Me.PerformLayout()

    End Sub

#End Region

    Private Sub transfert_pulve_Load(sender As Object, e As EventArgs) Handles Me.Load
        Dim objComboItem_Tous As New objComboItem("0", "Tous")
        Dim objComboItem_SIREN As New objComboItem("1", "N° SIREN")
        Dim objComboItem_RS As New objComboItem("2", "Raison Sociale")
        Dim objComboItem_Prenom As New objComboItem("3", "Prénom")
        Dim objComboItem_Nom As New objComboItem("4", "Nom")
        Dim objComboItem_DateC As New objComboItem("5", "Date de controle")
        list_search_fieldSearch.Items.Add(objComboItem_Tous)
        list_search_fieldSearch.Items.Add(objComboItem_SIREN)
        list_search_fieldSearch.Items.Add(objComboItem_RS)
        list_search_fieldSearch.Items.Add(objComboItem_Prenom)
        list_search_fieldSearch.Items.Add(objComboItem_Nom)
        list_search_fieldSearch.Items.Add(objComboItem_DateC)
        list_search_fieldSearch.SelectedIndex = 0
        If Not GlobalsCRODIP.GLOB_ENV_MODEFORMATION Then
            Me.Text = "Crodip .::. Transfert pulverisateur"
        Else
            Me.Text = "Transfert pulverisateur"
        End If

    End Sub

    Private Sub btn_proprietaire_rechercher_Click(sender As Object, e As EventArgs) Handles btn_proprietaire_rechercher.Click
        searchExploitant()
    End Sub
    Private Sub searchExploitant()
        Dim searchId As Integer
        Dim searchCriteria As String
        Dim ocol As List(Of Exploitation)

        If list_search_fieldSearch.SelectedItem IsNot Nothing Then
            searchId = list_search_fieldSearch.SelectedItem.id
            searchCriteria = client_search_query.Text
            ocol = ExploitationManager.searchExploitation(m_Agent, searchId, searchCriteria)
            AfficheListeExploitation(False, ocol)

        End If


    End Sub

    Private Sub AfficheListeExploitation(ByVal pisAlerte As Boolean, ByVal pColExploit As List(Of Exploitation))
        ' On récupère la liste des profils locaux
        Dim intCount As Decimal = 0
        Dim oExploit As Exploitation

        list_clients.Items.Clear()
        For Each oExploit In pColExploit
            'si l'affichage est en mode alerte
            '   on n'affiche que les exploitations
            '   Qui n'ont pas de date de dernier controle
            '       ou
            '   Qui ont un pulvé en alerte (date de prochain controle < aujourd'hui)


            If (pisAlerte And (oExploit.nPulvesAlerte = 0 And oExploit.dateDernierControle <> "")) Then
                'On n'affiche pas ces exploitations
            Else

                list_clients.Items.Add(oExploit.numeroSiren) ' SIREN
                list_clients.Items(CInt(intCount)).Tag = oExploit.id
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.raisonSociale) 'RS
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.prenomExploitant) ' Prénom
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.nomExploitant) ' Nom
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.adresse) ' Adresse
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.codePostal) ' Code postal
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.commune) ' Commune
                If oExploit.dateDernierControle <> "" And oExploit.dateDernierControle <> "30/12/1899 00:00:00" Then
                    Dim tmpDateNextDiag As Date = oExploit.dateDernierControle
                    list_clients.Items(CInt(intCount)).SubItems.Add(tmpDateNextDiag.ToShortDateString)  ' Dernier contrôle
                Else
                    list_clients.Items(CInt(intCount)).SubItems.Add("")  ' Dernier contrôle
                End If
                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.nPulvesAlerte) ' Nbre de pulvé en alerte
                '                list_clients.Items(CInt(intCount)).SubItems.Add(oExploit.id) ' IDExploitation

                ' Détection des alertes
                If oExploit.nPulvesAlerte > 0 Then
                    list_clients.Items(CInt(intCount)).BackColor = System.Drawing.Color.LightBlue
                    list_clients.Items(CInt(intCount)).ForeColor = System.Drawing.Color.Black
                End If

                intCount = intCount + 1
            End If

        Next oExploit

    End Sub

    Private Sub btnTransferer_Click(sender As Object, e As EventArgs) Handles btnTransferer.Click
        TransfertPulve()
    End Sub

    Private Sub TransfertPulve()
        If list_clients.SelectedItems.Count = 1 Then
            'Recupération du client
            Dim oExploitCible As Exploitation
            Dim ExploitId As String
            ExploitId = list_clients.SelectedItems(0).Tag
            oExploitCible = ExploitationManager.getExploitationById(ExploitId)
            ' On informe l'utilisateur et on lui demande confirmation
            If MsgBox("Attention, vous allez transfert le pulverisateur N° " & m_Pulve.numeroNational & " de l'exploitation " & m_ExploitOrigine.raisonSociale & " vers l'exploitation " & oExploitCible.raisonSociale & ",Etes-vous sûr ?", MsgBoxStyle.YesNo, "Transfert d'un pulvérisateur") = MsgBoxResult.Yes Then
                m_Pulve.TransfertPulve(m_ExploitOrigine.id, oExploitCible.id, m_Agent)
                Me.Close()
            End If
        End If
    End Sub
End Class