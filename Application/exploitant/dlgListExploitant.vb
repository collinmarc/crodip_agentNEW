Imports System.Collections.Generic
Imports System.Windows.Forms

Public Class dlgListExploitant
    Private _Exploitation As Exploitation
    Private m_oAgent As Agent
    Public Property oExploit() As Exploitation
        Get
            Return _Exploitation
        End Get
        Set(ByVal value As Exploitation)
            _Exploitation = value
        End Set
    End Property
    Public Sub SetContexte(pAgent As Agent)
        m_oAgent = pAgent
    End Sub
    Private Sub OK_Button_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OK_Button.Click
        oExploit = m_bsrcExploitant.Current
        Me.DialogResult = System.Windows.Forms.DialogResult.OK
        Me.Close()
    End Sub

    Private Sub Cancel_Button_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Cancel_Button.Click
        oExploit = Nothing
        Me.DialogResult = System.Windows.Forms.DialogResult.Cancel
        Me.Close()
    End Sub

    Private Sub dlgListExploitant_Load(sender As Object, e As EventArgs) Handles Me.Load

        Dim objComboItem As objComboItem
        objComboItem = New objComboItem("0", "Tous")
        list_search_fieldSearch.Items.Add(objComboItem)
        objComboItem = New objComboItem("1", "N° SIREN")
        list_search_fieldSearch.Items.Add(objComboItem)
        objComboItem = New objComboItem("2", "Raison Sociale")
        list_search_fieldSearch.Items.Add(objComboItem)
        objComboItem = New objComboItem("3", "Prénom")
        list_search_fieldSearch.Items.Add(objComboItem)
        objComboItem = New objComboItem("4", "Nom")
        list_search_fieldSearch.Items.Add(objComboItem)
        list_search_fieldSearch.SelectedIndex = 0

        oExploit = Nothing

    End Sub

    Private Sub btn_proprietaire_rechercher_Click(sender As Object, e As EventArgs) Handles btn_proprietaire_rechercher.Click
        Rechercher()
    End Sub

    Private Sub Rechercher()
        Dim searchId As String
        Dim searchcriteria As String
        If list_search_fieldSearch.SelectedItem IsNot Nothing Then
            searchId = list_search_fieldSearch.SelectedItem.id
            searchcriteria = client_search_query.Text

            Dim olst As List(Of Exploitation)
            Me.Cursor = Cursors.WaitCursor
            olst = ExploitationManager.searchExploitation(m_oAgent, searchId, searchcriteria)
            Me.Cursor = Cursors.Default
            m_bsrcExploitant.Clear()
            olst.ForEach(Function(oExploit) m_bsrcExploitant.Add(oExploit))
        End If
    End Sub

    Private Sub DataGridView1_CellContentDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.CellContentDoubleClick
        oExploit = m_bsrcExploitant.Current
        Me.DialogResult = System.Windows.Forms.DialogResult.OK
        Me.Close()

    End Sub

    Private Sub client_search_query_TextChanged(sender As Object, e As EventArgs) Handles client_search_query.TextChanged
    End Sub

    Private Sub client_search_query_KeyPress(sender As Object, e As KeyPressEventArgs) Handles client_search_query.KeyPress
        If e.KeyChar = vbCr Then
            e.Handled = True
            Rechercher()
        End If
    End Sub
End Class
